<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mass-Spring-Damper Simulation</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #000;
      color: #f5f5f5;
      max-width: 900px;
      margin: 2rem auto;
      line-height: 1.6;
    }
    code {
      background: #111;
      padding: 2px 4px;
      border-radius: 4px;
    }
    h1, h2 {
      color: #6a0dad;
    }
    a {
      color: #ffffff;
      text-decoration: underline;
    }
    a:hover {
      color: #c299ff;
    }
    canvas {
      width: 100%;
      height: 400px;
      background: #111;
      border: 1px solid #6a0dad;
      margin: 1rem 0;
    }
    input[type="range"], select {
      width: 100%;
      margin-top: 0.5rem;
    }
    label {
      display: block;
      margin-top: 1rem;
      font-weight: 500;
    }
    .plot-container {
      display: flex;
      flex-direction: row;
      gap: 1rem;
    }
    .plot-container canvas {
      flex: 1;
    }
  </style>
</head>
<body>
  <h1>Mass-Spring-Damper Oscillator</h1>

  <p>This simulation compares the behavior of a mass-spring-damper system using an analytic solution and a numerical Runge-Kutta 4 (RK4) method.</p>

  <h2>2 · Mathematical Model</h2>
  <p>
    The motion of a mass-spring-damper system is governed by Newton's second law:
  </p>
  <p>
    $$ m \\ddot{x} + c \\dot{x} + kx = 0 $$
  </p>
  <p>
    Where:
    <ul>
      <li><code>m</code> is the mass</li>
      <li><code>c</code> is the damping coefficient</li>
      <li><code>k</code> is the spring constant</li>
      <li><code>x(t)</code> is the displacement from equilibrium</li>
    </ul>
  </p>
  <p>
    This is a second-order linear differential equation. Depending on the damping, it leads to:
  </p>
  <ul>
    <li><strong>Underdamped</strong> (oscillatory): \( c^2 < 4mk \)</li>
    <li><strong>Critically damped</strong>: \( c^2 = 4mk \)</li>
    <li><strong>Overdamped</strong>: \( c^2 > 4mk \)</li>
  </ul>
  
  <h2>Mathematical Model</h2>
  <p>The system is modeled by a second-order differential equation:</p>
  <pre><code>m * d²x/dt² + c * dx/dt + k * x = 0</code></pre>

  <p>We normalize the equation by dividing through by mass <code>m</code>:</p>
  <pre><code>d²x/dt² + 2ζωₙ dx/dt + ωₙ²x = 0</code></pre>

  <p>where:</p>
  <ul>
    <li>ωₙ = √(k/m) is the natural frequency</li>
    <li>ζ = c / (2√(km)) is the damping ratio</li>
  </ul>

  <h2>Solution Types</h2>
  <p>The behavior depends on the value of damping ratio ζ:</p>
  <ul>
    <li><strong>Underdamped (ζ &lt; 1)</strong>: oscillates with decreasing amplitude</li>
    <li><strong>Critically damped (ζ = 1)</strong>: returns to rest as quickly as possible without oscillating</li>
    <li><strong>Overdamped (ζ &gt; 1)</strong>: returns to rest slowly without oscillating</li>
  </ul>

  <p>Solutions:</p>
  <pre><code>// Underdamped
  x(t) = A * e^(-ζωₙt) * cos(ω_d t + φ), where ω_d = ωₙ * √(1 - ζ²)
  
  // Critically damped
  x(t) = (A + Bt) * e^(-ωₙt)
  
  // Overdamped
  x(t) = A * e^(r₁t) + B * e^(r₂t), where r₁, r₂ = -ωₙ(ζ ± √(ζ² - 1))</code></pre>

  <h2>Numerical Solution with RK4</h2>
  <p>We convert to a system of first-order ODEs:</p>
  <pre><code>dx/dt = v

dv/dt = -2ζωₙv - ωₙ²x</code></pre>
  <p>The RK4 method approximates values step-by-step for better accuracy.</p>

  <h2>Simulation</h2>

  <label>Initial Displacement (x₀)</label>
  <input type="range" id="x0Slider" min="-10" max="10" step="0.1" value="5">
  <label>Initial Velocity (v₀)</label>
  <input type="range" id="v0Slider" min="-10" max="10" step="0.1" value="0">
  <label>Damping Type</label>
  <select id="dampingSelect">
    <option value="underdamped">Underdamped</option>
    <option value="critical">Critically Damped</option>
    <option value="overdamped">Overdamped</option>
  </select>

  <h2>3 · Controls</h2>
  <label for="initialPosition">Initial Position (x₀)</label>
  <input type="range" id="initialPosition" min="-100" max="100" value="50" step="1" oninput="updateInitialConditions()">
  
  <label for="initialVelocity">Initial Velocity (v₀)</label>
  <input type="range" id="initialVelocity" min="-100" max="100" value="0" step="1" oninput="updateInitialConditions()">

  <h2>4 · Analytic vs RK4 Solution</h2>
  <canvas id="comparisonPlot" width="700" height="300"></canvas>

  <h2>4 · Analytic vs RK4 Solution</h2>
<canvas id="comparisonPlot" width="700" height="300"></canvas>

<script>
  // JavaScript for plotting Analytic vs RK4
  const canvas = document.getElementById("comparisonPlot");
  const ctx = canvas.getContext("2d");

  // System parameters
  const m = 1.0;
  const k = 10.0;
  const c = 0.5;
  const omega0 = Math.sqrt(k / m);
  const zeta = c / (2 * Math.sqrt(k * m));

  // Initial conditions
  const x0 = 50;
  const v0 = 0;
  const dt = 0.02;
  const totalTime = 10;

  function analyticSolution(t) {
    if (zeta < 1) {
      const omega_d = omega0 * Math.sqrt(1 - zeta ** 2);
      const A = x0;
      const B = (v0 + zeta * omega0 * x0) / omega_d;
      return Math.exp(-zeta * omega0 * t) * (A * Math.cos(omega_d * t) + B * Math.sin(omega_d * t));
    } else {
      return 0; // Overdamped/critically damped not handled
    }
  }

  function rk4Step(state, dt) {
    const [x, v] = state;

    const dxdt = (x, v) => v;
    const dvdt = (x, v) => (-k * x - c * v) / m;

    const k1x = dt * dxdt(x, v);
    const k1v = dt * dvdt(x, v);

    const k2x = dt * dxdt(x + 0.5 * k1x, v + 0.5 * k1v);
    const k2v = dt * dvdt(x + 0.5 * k1x, v + 0.5 * k1v);

    const k3x = dt * dxdt(x + 0.5 * k2x, v + 0.5 * k2v);
    const k3v = dt * dvdt(x + 0.5 * k2x, v + 0.5 * k2v);

    const k4x = dt * dxdt(x + k3x, v + k3v);
    const k4v = dt * dvdt(x + k3x, v + k3v);

    const newX = x + (k1x + 2 * k2x + 2 * k3x + k4x) / 6;
    const newV = v + (k1v + 2 * k2v + 2 * k3v + k4v) / 6;

    return [newX, newV];
  }

  // Generate data
  const analyticPoints = [];
  const rk4Points = [];
  let t = 0;
  let state = [x0, v0];

  while (t <= totalTime) {
    analyticPoints.push(analyticSolution(t));
    rk4Points.push(state[0]);
    state = rk4Step(state, dt);
    t += dt;
  }

  // Plotting
  function drawComparison() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.lineWidth = 2;

    const scaleX = canvas.width / analyticPoints.length;
    const scaleY = 2;

    // Analytic - Purple
    ctx.strokeStyle = "#c299ff";
    ctx.beginPath();
    ctx.moveTo(0, 150 - analyticPoints[0] / scaleY);
    for (let i = 1; i < analyticPoints.length; i++) {
      ctx.lineTo(i * scaleX, 150 - analyticPoints[i] / scaleY);
    }
    ctx.stroke();

    // RK4 - White
    ctx.strokeStyle = "#ffffff";
    ctx.beginPath();
    ctx.moveTo(0, 150 - rk4Points[0] / scaleY);
    for (let i = 1; i < rk4Points.length; i++) {
      ctx.lineTo(i * scaleX, 150 - rk4Points[i] / scaleY);
    }
    ctx.stroke();
  }

  drawComparison();
</script>

  <p><span style="color:#c299ff;">Purple</span> = Analytic, <span style="color:#ffffff;">White</span> = RK4</p>
  
  <div class="plot-container">
    <div>
      <h3>Analytic Solution</h3>
      <canvas id="analyticCanvas"></canvas>
    </div>
    <div>
      <h3>RK4 Solution</h3>
      <canvas id="rkCanvas"></canvas>
    </div>
  </div>

  <h2>Energy & Phase Space</h2>
  <canvas id="energyCanvas"></canvas>
  <canvas id="phaseCanvas"></canvas>

  <h2>5 · Python Source Breakdown</h2>
  <p>
    The Python script solves the same mass-spring-damper equation using the Runge-Kutta 4th order method.
  </p>
  <p>
    <strong>Key Sections:</strong>
    <ul>
      <li><code>derivatives(t, y)</code>: Defines the differential equation</li>
      <li><code>rk4()</code>: Numerically integrates using 4 intermediate slopes</li>
      <li><code>matplotlib</code>: Plots the displacement over time</li>
    </ul>
  </p>
  
  <h2>6 · Source Code</h2>
  <p>
    <a href="mass_spring_damp.py" target="_blank">mass_spring_damp.py</a>
  </p>

  <h2>Python Source Code</h2>
  <p>Download the full Python script: <a href="/spring_mass_rk4.py" download>spring_mass_rk4.py</a></p>
  <p>It defines a function that implements RK4 integration, compares with analytic results, and plots both. You can experiment by modifying the damping ratio and initial conditions.</p>

  <script src="main.js"></script>
</body>
</html>
